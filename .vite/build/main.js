"use strict";const o=require("electron"),u=require("path"),w=require("sharp"),f=require("os"),y=require("electron-store");function j(e){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const t in e)if(t!=="default"){const i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,i.get?i:{enumerable:!0,get:()=>e[t]})}}return n.default=e,Object.freeze(n)}const d=j(u);function D(e,n=!0,t=u.join(f.homedir(),"Downloads"),i){try{const r=e.path,l=e.name;console.log(e.type);let s="";const h=l.slice(0,-u.extname(l).length);n?(s=`${t}/converted_${h}.webp`,w(r).webp({quality:i}).toFormat("webp").toFile(s)):(s=`${t}/converted_${h}.jpg`,w(r).webp({lossless:!0}).toFormat("jpeg").toFile(s)),console.log(`변환 성공! 변환파일: ${s}`)}catch(r){throw console.error("변환 도중 오류:",r),r}}require("electron-squirrel-startup")&&o.app.quit();let c=!0,p=0,a=d.join(f.homedir(),"Downloads"),g=1;const m=new y,P=async()=>{const{canceled:e,filePaths:n}=await o.dialog.showOpenDialog({title:"PathSelecter",defaultPath:a,properties:["openDirectory","createDirectory"],message:"변환된 이미지 파일의 저장 위치 지정"});e||(a=n[0],m.set("outputPath",a))},$=()=>{o.shell.openPath(a)},b=()=>{const e=new o.BrowserWindow({width:560,height:360,webPreferences:{preload:d.join(__dirname,"preload.js"),nodeIntegration:!0}});a=m.get("outputPath"),e.loadFile(d.join(__dirname,"../renderer/main_window/index.html")),o.ipcMain.on("presetting:setQuality",(n,t)=>{g=t}),o.ipcMain.on("toMain",(n,t)=>{p=0;let i=!0;const r=70+10*g;console.log(`변환 설정 방향:${c} 저장위치:${a} 압축률:${r}`),t.forEach(l=>{try{D(l,c,a,r),p++,e.webContents.send("update-counter",p/t.length*100),console.log("진행도",p)}catch(s){console.error("main.ts 변환반복 중 오류발생",s.message),i=!1}}),e.webContents.send("success",t[0].name,t.length,i)})};o.app.whenReady().then(()=>{o.ipcMain.handle("presetting:openFileDialog",P),o.ipcMain.handle("presetting:openOutputDirectory",$),b()});o.app.on("window-all-closed",()=>{process.platform!=="darwin"&&o.app.quit()});o.app.on("activate",()=>{o.BrowserWindow.getAllWindows().length===0&&b()});o.ipcMain.handle("direction:toggle",()=>{c?c=!1:c=!0});
